parameters:
  - name: app_name
    type: string
    default: ""
  - name: var_group
    type: string
    default: ""
  - name: var_file
    type: string
    default: ""

variables:
  - group: "${{ parameters.var_group }}"
  - template: "${{ parameters.app_secret }}"

steps:
  - task: Gradle@2
    inputs:
      workingDirectory: ''
      gradleWrapperFile: 'gradlew'
      gradleOptions: '-Xmx3072m'
      publishJUnitResults: false
      testResultsFiles: '**/TEST-*.xml'
      tasks: 'assembleDebug -Pdomain_name=$(domain_name) -Papp_secret=$(app_secret) -PversionCode=$(Build.BuildNumber)'
  - task: CopyFiles@2
    inputs:
      contents: '**/*.apk'
      targetFolder: '$(build.artifactStagingDirectory)'
  - task: PublishBuildArtifacts@1
    inputs:
      pathToPublish: '$(build.artifactStagingDirectory)/app/build/outputs/'
      artifactName: 'apk-files-${{ parameters.app_name }}'
      artifactType: 'container'